{% extends "user_admin/admin_base.html" %}
{% block title %}Inventory | Assets{% endblock %}
{% block inventory %}
    class="nav-link"
{% endblock %}
{% block assets %}
    class="active"
{% endblock %}
{% block content %}
    {% include "aqua_assets/_modal.html" %}
    <main id="main" class="main">
        <!-- Success Alert -->
        <div class="page-title">
            <h3 style="font-weight: bold"> Assets</h3>
            <div class="filter-and-search d-flex align-items-right ">
                <div class="col-md-4" style="margin-right: 5px">
                    <input type="text" id="search_asset" name="query" class="form-control" placeholder="Search"
                           title="Enter search keyword">
                </div>
                <div class="col-md-4" style="margin-right: 5px">

                    <select class="form-select" id="asset_type_filter">
                        <option selected value="all">Asset Type: All</option>
                        {% for asset in asset_type %}
                            <option value="{{ asset }}">{{ asset }}</option>
                        {% endfor %}
                    </select>

                </div>
                <div class="col-md-4 d-flex align-items-right">
                    <button id="create-asset" class="btn btn-primary" style="background-color:#3850A6;" type="button"
                            name="button">
                        <i class="bi bi-house-add"></i>&nbsp; Add Asset
                    </button>
                </div>
            </div>
            <section class=" ">
                <br>
                <div style="display: block;">
                    <div class="card">
                        {% include 'aqua_assets/_asset_table.html' %}
                    </div>
                </div>
            </section>
        </div>
        <script type="text/javascript">
            // Create Asset
            $(function () {
                function createAssetsSyncModalForm() {
                    $("#create-asset").modalForm({
                        formURL: "{% url 'add_asset' %}",
                        modalID: "#create-modal"
                    });
                }

                createAssetsSyncModalForm();

                function viewAssetModalForm() {
                    $(".asset-view").each(function () {
                        $(this).modalForm({formURL: $(this).data("form-url")});
                    });
                }

                viewAssetModalForm();

                function deleteAssetModalForm() {
                    $(".asset-delete").each(function () {
                        $(this).modalForm({formURL: $(this).data("form-url"), isDeleteForm: true});
                    });
                }

                deleteAssetModalForm();

                function updateAssetModalForm() {
                    $(".asset-update").each(function () {
                        $(this).modalForm({
                            formURL: $(this).data("form-url"),
                            syncUpdate: true,
                        });
                    });
                }

                updateAssetModalForm();

                $('#asset-table .btn').click(function (e) {
                    e.stopPropagation();
                });

                $('.asset-delete').click(function (e) {
                    e.stopPropagation();
                });
            });
            $(document).ready(function () {
                // Handle dropdown change events for both type and status filters
                // and input event for search
                $('#asset_type_filter, #search_asset').on('change input', function () {
                    // Get the selected values for both filters
                    selectedType = $('#asset_type_filter').val().toLowerCase();

                    // Get the search query
                    var query = $('#search_asset').val().toLowerCase();

                    // Show/hide rows based on the selected type, status, and search query
                    $('#asset-table tbody tr').each(function () {
                        var rowType = $(this).data('type').toLowerCase();
                        var rowName = $(this).data('name').toLowerCase();

                        if ((selectedType === 'all' || rowType === selectedType) &&
                            (rowName.includes(query) || query === '')) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                });
            });
        </script>
    </main>
    <!-- End #main -->
{% endblock %}